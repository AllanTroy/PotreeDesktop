<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Potree Desktop</title>

		<link rel="stylesheet" type="text/css" href="./libs/potree/potree.css">
		<link rel="stylesheet" type="text/css" href="./libs/jquery-ui/jquery-ui.min.css">
		<link rel="stylesheet" type="text/css" href="./libs/perfect-scrollbar/css/perfect-scrollbar.css">
		<link rel="stylesheet" type="text/css" href="./libs/openlayers3/ol.css">
		<link rel="stylesheet" type="text/css" href="./libs/spectrum/spectrum.css">
		<link rel="stylesheet" type="text/css" href="./libs/jstree/themes/mixed/style.css">
	</head>
	<body>

		<!-- https://stackoverflow.com/questions/32621988/electron-jquery-is-not-defined -->
		<script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>

		<script src="./libs/jquery/jquery-3.1.1.js"></script>
		<script src="./libs/spectrum/spectrum.js"></script>
		
		<!--<script src="./libs/other/webgl-debug.js"></script>-->
		<script src="./libs/perfect-scrollbar/js/perfect-scrollbar.jquery.js"></script>
		<script src="./libs/jquery-ui/jquery-ui.min.js"></script>
		<script src="./libs/three.js/build/three.js"></script>
		<script src="./libs/other/stats.min.js"></script>
		<script src="./libs/other/BinaryHeap.js"></script>
		<script src="./libs/tween/tween.min.js"></script>
		<script src="./libs/d3/d3.js"></script>
		<script src="./libs/proj4/proj4.js"></script>
		<script src="./libs/openlayers3/ol.js"></script>
		<script src="./libs/i18next/i18next.js"></script>
		<script src="./libs/jstree/jstree.js"></script>
		
		<script src="./libs/potree/potree.js"></script>

		<div class="potree_container" style="position: absolute; width: 100%; height: 100%; left: 0px; top: 0px; ">
	
			<div id="potree_render_area">
				<div id="potree_map" class="mapBox" style="position: absolute; left: 50px; top: 50px; width: 400px; height: 400px; display: none">
					<div id="potree_map_header" style="position: absolute; width: 100%; height: 25px; top: 0px; background-color: rgba(0,0,0,0.5); z-index: 1000; border-top-left-radius: 3px; border-top-right-radius: 3px;">
					</div>
					<div id="potree_map_content" class="map" style="position: absolute; z-index: 100; top: 25px; width: 100%; height: calc(100% - 25px); border: 2px solid rgba(0,0,0,0.5); box-sizing: border-box;"></div>
				</div>
			
				<div id="potree_description" class="potree_info_text"></div>
			</div>
			
			<div id="potree_sidebar_container"> </div>
		</div>


		<script>

		function allowDrag(e) {
			console.log("allowDrag");
			if (true) {
				e.dataTransfer.dropEffect = 'copy';
				e.preventDefault();
			}
		}


		function dropHandler(event){
			console.log(event);
			event.preventDefault();

			for(let i = 0; i < event.dataTransfer.items.length; i++){
				let item = event.dataTransfer.items[i];

				if(item.kind !== "file"){
					continue;
				}

				let file = item.getAsFile();
				let path = file.path;
				let folderName = path.replace(/\\/g, "/").split("/").reverse()[1];

				Potree.loadPointCloud(path, folderName, function(e){
					viewer.scene.addPointCloud(e.pointcloud);
					viewer.zoomTo(e.pointcloud);
				});
			}
		}
		$("body")[0].addEventListener("dragenter", allowDrag);
		$("body")[0].addEventListener("dragover", allowDrag);
		$("body")[0].addEventListener("drop", dropHandler);
	
		window.viewer = new Potree.Viewer(document.getElementById("potree_render_area"));
		//$("canvas")[0].addEventListener("drop", dropHandler);
		
		viewer.setEDLEnabled(true);
		viewer.setFOV(60);
		viewer.setPointBudget(10*1000*1000);
		viewer.setMinNodeSize(0);
		viewer.useEDL = false;
		viewer.loadSettingsFromURL();
		
		viewer.setDescription("");
		
		viewer.loadGUI(() => {
			viewer.setLanguage('en');
			$("#menu_appearance").next().show();
			$("#menu_tools").next().show();
			$("#menu_scene").next().show();
			viewer.toggleSidebar();
		});
		
		// Sigeom
		//Potree.loadPointCloud("C:/dev/pointclouds/archpro/heidentor.laz_converted/cloud.js", "Heidentor", function(e){
		////Potree.loadPointCloud("http://5.9.65.151/mschuetz/potree/resources/pointclouds/archpro/heidentor/cloud.js", "Heidentor", function(e){
		//	viewer.scene.addPointCloud(e.pointcloud);
		//	e.pointcloud.position.z = 0;
		//	let material = e.pointcloud.material;
		//	material.size = 1;
		//	material.pointSizeType = Potree.PointSizeType.ADAPTIVE;

		//	viewer.switchCameraMode(Potree.CameraMode.ORTHOGRAPHIC);

		//	viewer.scene.view.position.set(13.856734292740617, -9.125174923658731, 14.563928417406354);
		//	viewer.scene.view.lookAt(-3.5482630104475366, 2.728596783815762, 6.1406044783018725);
		//	//viewer.fitToScreen();

		//	//Potree.measureTimings = true;
		//});
		
	</script>


	</body>
</html>
